---
title: Adding in a database
description: A simple website built using flask
sidebar:
   order: 6
---

While using dictionaries to store data is fine for small projects, it is not a good idea for larger projects. We normally want our data to be persistent and not lost when the server is restarted. This is where databases come in. Databases are used to store data in a structured way and can be queried to retrieve data.

We will be using SQLite for these resources but any SQL database can be used. SQLite is a lightweight database that is easy to use and is perfect for small projects.

:::note
This tutorial assumes that you have a basic understanding of SQL and databases. If you are not familiar with databases, you can check out the [SQL tutorial](/guides/sql).
:::

## Setting up the database

First, we need to create a database and a table to store our data. We will be storing the data in a table called `posts` with the following columns:

- `id`: The unique identifier for each post
- `title`: The title of the post
- `content`: The content of the post

We will be using the `sqlite3` module to interact with the database. The `sqlite3` module is included with Python so you don't need to install anything.

Create a new file called `database.py` and add the following code:

```python
import sqlite3

# Create a new database file
conn = sqlite3.connect('blog.db')

# Create a new table called posts
conn.execute('''
CREATE TABLE posts
(
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title TEXT NOT NULL,
    content TEXT NOT NULL
)
''')

# Commit the changes
conn.commit()

# Close the connection
conn.close()
```

This code creates a new database file called `blog.db` and creates a new table called `posts` with the required columns. The `id` column is the primary key and will auto-increment for each new post.

Run the `database.py` file to create the database and table:

```bash
python database.py
```

## Using our database with flask

Now that we have our database set up, we can start using it in our Flask application. We will be using the `sqlite3` module to interact with the database.

```python
import sqlite3
from flask import g, Flask

app = Flask(__name__)

def get_db():
   db = getattr(g, "_database", None)
   if db is None:
       db = g._database = sqlite3.connect("blog.db")
   return db

@app.teardown_appcontext
def close_connection(exception):
   db = getattr(g, "_database", None)
   if db is not None:
       db.close()


@app.route("/")
def index():
   db = get_db()
   posts = db.execute("SELECT * FROM posts").fetchall()
   return posts
```

import { Steps } from '@astrojs/starlight/components';

<Steps>

1. We first define a `get_db` function that returns a connection to the database. 

   We use the `g` object to store the connection so that it can be reused across requests.
   This function will return the connection if it already exists, otherwise, it will create a new connection to the database.

2. We define a `close_connection` function that closes the connection to the database when the request is finished.

   We use the `teardown_appcontext` decorator to register this function so that when the app closes the connection is closed.

3. We define a route called `/` that fetches all the posts from the database and returns them.

   We use the `execute` method to execute an SQL query and the `fetchall` method to fetch all the results.

</Steps>

## Using SQLAlchemy

While using the `sqlite3` module directly is fine for small projects, it can be cumbersome for larger projects. SQLAlchemy is a popular ORM (Object-Relational Mapping) library that makes it easy to interact with databases.

To use SQLAlchemy, you need to install the `flask_sqlalchemy` package:

```bash
pip install flask_sqlalchemy
```

You can then use the `SQLAlchemy` class to create a new database connection:

```python
from flask import Flask
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)

app.config["SQLALCHEMY_DATABASE_URI"] = "sqlite:///blog.db"

db = SQLAlchemy(app)
```