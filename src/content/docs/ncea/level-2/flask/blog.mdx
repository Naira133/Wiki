---
title: Basic Blog
description: A simple website built using flask
sidebar:
    order: 4
---

> using custom forms to add user input to the database
> linking data in related tables or nodes using queries or keys

```python
// flaskapp/blog.py
"""Blog routes."""
from flask import Blueprint, redirect, render_template, request, url_for
from werkzeug.exceptions import abort

from flaskapp.db import get_db

bp = Blueprint("blog", __name__)
```

With our blueprint created we can now register it with the app. The `index` route in our blueprint is also going to be the main page of our website so we will set a url rule to link it to `/`.

```diff lang=python
// flaskapp/__init__.py
def create_app():
    app = ...
    # existing code omitted

+    from . import blog
+
+    app.register_blueprint(blog.bp)
+    app.add_url_rule('/', endpoint='index')

    return app
```

```python
@bp.route("/")
def index():
    """Main view page."""
    db = get_db()
    posts = db.execute(
        "SELECT post.id, post.title, body, post.created, "
        "count(comment.id) AS comment_amount FROM post LEFT JOIN comment ON "
        "comment.post_id=post.id group by post.id",
    ).fetchall()
    return render_template("blog/index.html", posts=posts)
```

```python
def get_post(id):
    """Get a blog post.

    Args:
        id (int): the id of the post to get.

    Returns:
        the post if found otherwise redirects the user to a 404.
    """
    post = (
        get_db()
        .execute(
            "SELECT id, title, body, created FROM post WHERE id = ?",
            (id,),
        )
        .fetchone()
    )

    if post is None:
        abort(404, f"Post id {id} doesn't exist.")

    return post


def get_comments(id):
    """Gets all comments on a post.

    Args:
        id (int): the id of the post to get.

    Returns:
        A list of all comments if found.
    """
    post = (
        get_db()
        .execute(
            "SELECT id, body, created FROM comment WHERE post_id = ?",
            (id,),
        )
        .fetchall()
    )

    return post


@bp.route("/<int:id>/post", methods=("GET", "POST"))
def post(id):
    """Post page with comments and the ability to add comments."""
    error = None
    if request.method == "POST":
        body = request.form["body"]

        if len(body) < 10:
            error = "Comment is too short"

        if error is None:
            db = get_db()
            db.execute(
                "INSERT INTO comment (body, post_id) VALUES (?, ?)",
                (
                    body,
                    id,
                ),
            )
            db.commit()
            return redirect(f"/{id}/post")
    post = get_post(id)
    comments = get_comments(id)
    return render_template(
        "blog/post.html",
        post=post,
        comments=comments,
        error=error,
    )
```

1. The route of `/<int:id>/post` means that the route will be `/1/post` for example. The `int` part of the route means that the id will be converted to an integer before being passed to the function.

2. As this page has both `GET` and `POST` methods we need to check which method is being used. If the method is `POST` then we know that the user is trying to add a comment to the post. We then get the comment from the form and check that it is at least 10 characters long. If the comment is valid we then add it to the database and redirect the user back to the post page.
